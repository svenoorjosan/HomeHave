<!-- ==================== NAVBAR ==================== -->
<header class="sticky top-4 z-50 mx-auto mb-8 md:mb-10
         w-[95%] sm:w-[90%] lg:w-[80%] xl:w-[70%]
         text-white p-4 shadow-xl shadow-black/60 ring-1 ring-white/10
         rounded-2xl relative overflow-visible">

  <!-- Background wrapper that CLIPS to the rounded corners -->
  <div class="absolute inset-0 rounded-2xl overflow-hidden pointer-events-none z-0">
    <div class="absolute inset-0 bg-neutral-800/30 bg-gradient-to-br
                from-gray-900/80 via-gray-800/70 to-gray-900/80 backdrop-blur-lg"></div>
    <!-- Vanta canvas sits under nav and is clipped -->
    <div id="nav-vanta" class="absolute inset-0"></div>
  </div>

  <nav class="container mx-auto flex justify-between items-center relative z-10">

    <!-- ============= DESKTOP NAV ============= -->
    <div class="hidden md:flex md:justify-between md:items-center w-full">
      <ul class="flex items-center flex-wrap gap-2">
        <!-- Home -->
        <li>
          <a href="/" class="<%= currentPage === 'index'
               ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
               : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
               py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
              <path
                d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" />
              <path
                d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z" />
            </svg>
            HomeHave
          </a>
        </li>

        <% if (isLoggedIn) { %>
          <% if (user && user.userType==='guest' ) { %>
            <li>
              <a href="/homes" class="<%= currentPage === 'Home'
                   ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                   : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                   py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-1">
                Homes
              </a>
            </li>
            <li>
              <a href="/favourites" class="<%= currentPage === 'favourites'
                   ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                   : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                   py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-1">
                Favourites
              </a>
            </li>
            <li>
              <a href="/bookings" class="<%= currentPage === 'bookings'
                   ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                   : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                   py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-1">
                Bookings
              </a>
            </li>
            <% } else { %>
              <li>
                <a href="/host/host-home-list" class="<%= currentPage === 'host-homes'
                   ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                   : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                   py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-1">
                  Host Homes
                </a>
              </li>
              <li>
                <a href="/host/add-home" class="<%= currentPage === 'addHome'
                   ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                   : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                   py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-1">
                  Add Home
                </a>
              </li>
              <% } %>
                <% } %>
      </ul>

      <!-- AUTH -->
      <ul class="flex items-center gap-3">
        <% if (!isLoggedIn) { %>
          <li>
            <a href="/signup" class="<%= currentPage === 'signup'
                 ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                 : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10 border border-white/20' %>
                 py-2 px-4 rounded-lg transition-all duration-300">
              SignUp
            </a>
          </li>
          <li>
            <a href="/login" class="<%= currentPage === 'login'
                 ? 'bg-white text-red-500 font-medium'
                 : 'bg-white/80 text-red-500 hover:bg-red-50' %>
                 py-2 px-4 rounded-lg transition-all duration-300 shadow-sm shadow-black/20">
              Login
            </a>
          </li>
          <% } else { %>
            <li>
              <form action="/logout" method="POST">
                <button type="submit" class="hover:bg-white/10 hover:ring-1 hover:ring-white/10 py-2 px-4 rounded-lg
                             transition-all duration-300 border border-white/20 flex items-center gap-1">
                  Logout
                </button>
              </form>
            </li>
            <% } %>
      </ul>
    </div>

    <!-- ============= MOBILE NAV ============= -->
    <div class="md:hidden w-full">
      <div class="flex justify-between items-center">
        <a href="/" class="flex items-center py-2 px-3 rounded-lg transition-all duration-300
                  <%= currentPage === 'index'
                    ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                    : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-1">
            <path
              d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" />
            <path
              d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z" />
          </svg>
          <span class="font-medium">HomeHave</span>
        </a>

        <button id="mobile-menu-button" type="button" aria-controls="mobile-menu" aria-expanded="false"
          class="p-2 rounded-lg hover:bg-white/10 hover:ring-1 hover:ring-white/10 transition-all duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
      </div>

      <div id="mobile-menu" class="hidden mt-3 border-t border-red-400 pt-3">
        <ul class="flex flex-col space-y-2">
          <% if (isLoggedIn) { %>
            <li><a href="/homes" class="<%= currentPage === 'Home'
                     ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                     : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                     py-2 px-3 rounded-lg flex items-center">Homes-List</a></li>
            <li><a href="/favourites" class="<%= currentPage === 'favourites'
                     ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                     : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                     py-2 px-3 rounded-lg flex items-center">Favourites</a></li>
            <li><a href="/bookings" class="<%= currentPage === 'bookings'
                     ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                     : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                     py-2 px-3 rounded-lg flex items-center">Bookings</a></li>
            <li><a href="/host/host-home-list" class="<%= currentPage === 'host-homes'
                     ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                     : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                     py-2 px-3 rounded-lg flex items-center">Host Homes</a></li>
            <li><a href="/host/add-home" class="<%= currentPage === 'addHome'
                     ? 'bg-red-600/80 ring-1 ring-white/10 shadow-md font-medium'
                     : 'hover:bg-white/10 hover:ring-1 hover:ring-white/10' %>
                     py-2 px-3 rounded-lg flex items-center">Add Home</a></li>
            <li class="pt-3 border-t border-red-400 mt-3">
              <form action="/logout" method="POST">
                <button type="submit"
                  class="hover:bg-white/10 hover:ring-1 hover:ring-white/10 py-2 px-3 rounded-lg w-full text-left flex items-center">
                  Logout
                </button>
              </form>
            </li>
            <% } else { %>
              <li><a href="/signup"
                  class="hover:bg-white/10 hover:ring-1 hover:ring-white/10 py-2 px-3 rounded-lg block border border-white/20">SignUp</a>
              </li>
              <li><a href="/login"
                  class="bg-white/80 text-red-500 hover:bg-red-50 py-2 px-3 rounded-lg block mt-2 shadow-sm shadow-black/20">Login</a>
              </li>
              <% } %>
        </ul>
      </div>
    </div>
  </nav>
</header>

<!-- Vendor scripts (include ONCE per page) -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/vanta/dist/vanta.topology.min.js"></script>

<!-- Navbar behavior -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Hamburger toggle
    const btn = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    if (btn && menu) {
      btn.addEventListener('click', () => {
        const open = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!open));
        menu.classList.toggle('hidden');
      });

      // Close on outside click
      document.addEventListener('click', (e) => {
        if (!menu.classList.contains('hidden') &&
          !menu.contains(e.target) && !btn.contains(e.target)) {
          menu.classList.add('hidden');
          btn.setAttribute('aria-expanded', 'false');
        }
      });

      // Close on Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          menu.classList.add('hidden');
          btn.setAttribute('aria-expanded', 'false');
        }
      });
    }

    // Vanta background for navbar (disabled on small screens or reduced motion)
    const mediaReduce = window.matchMedia('(prefers-reduced-motion: reduce)');
    const smallScreen = window.matchMedia('(max-width: 640px)');
    let navVanta;

    function startNavVanta() {
      if (mediaReduce.matches || smallScreen.matches || navVanta) return;
      const el = document.getElementById('nav-vanta');
      if (!el || !window.VANTA) return;

      navVanta = VANTA.TOPOLOGY({
        el,
        mouseControls: false,
        touchControls: false,
        gyroControls: false,
        backgroundAlpha: 0.0,
        color: 0xa98bfa,
        scale: 1.0,
        scaleMobile: 1.0,
        minHeight: 80.0,
        minWidth: 200.0
      });
    }

    function stopNavVanta() {
      if (navVanta) { navVanta.destroy(); navVanta = null; }
    }

    startNavVanta();
    mediaReduce.addEventListener('change', () => (mediaReduce.matches ? stopNavVanta() : startNavVanta()));
    smallScreen.addEventListener('change', () => (smallScreen.matches ? stopNavVanta() : startNavVanta()));
    window.addEventListener('beforeunload', stopNavVanta);
  });
</script>